<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.coffee.stockMapper">

	<!-- 오늘자 마감 조회 -->
	<select id="selectTodayMagam" resultType="MagamStatusDto">
		select * from magam 
		where to_char(sysdate, 'YYYYMMDD') = yrmo and magam_status != 2
	</select>
	
	<!-- 오늘자 마감 진행 -->
	<select id="closeTodayMagam" statementType="CALLABLE">
		BEGIN
			MM_COLLECTION_PKG.MM_COLLECTION_MAIN(to_char(sysdate, 'YYYYMMDD'), 1, 0);
		END;
	</select>
	
	<!-- 오늘자 마감 취소 -->
	<select id="cancelTodayMagam" statementType="CALLABLE">
		BEGIN
			MM_COLLECTION_PKG.MM_COLLECTION_MAIN(to_char(sysdate, 'YYYYMMDD'), 0, 0);
		END;
	</select>

	<!-- 오늘자 마감 상태 리턴 -->
	<select id="magamCheck" resultType="int">
		select 	NVL(MAX(magam_status), 0) as magam_status
		from 	magam
		where 	yrmo = TO_CHAR(sysdate, 'YYYYMMDD')
	</select>
	
</mapper>