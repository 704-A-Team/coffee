<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.coffee.ProductMapper">

	<insert id="wonProductSave" parameterType="ProductDto">
		<selectKey keyProperty="product_code" resultType="int" order="BEFORE">
            SELECT PRODUCT_SEQ.NEXTVAL FROM DUAL <!-- Oracle -->
            <!-- MySQL 또는 auto-increment 사용 시: SELECT LAST_INSERT_ID() -->
        </selectKey>
        insert into product
        (
        	 product_code
        	,product_name
        	,product_unit
        	,product_type
        	,product_weight
        	,product_isorder
        	,product_isdel
        	,product_reg_code
        	,product_reg_date 
        )
        values
        (
        	 #{product_code}
        	,#{product_name}
        	,#{product_unit}
        	,#{product_type}
        	,#{product_weight}
        	,#{product_isorder}
        	,#{product_isdel}
        	,#{product_reg_code}
        	,sysdate
        )
	</insert>
	
	<!-- <select id="totalProduct" resultType="int">
		select 	count(*) 
		from 	product
	</select> -->
	
	<select id="totalWonProduct" resultType="int">
		select 	count(*) 
		from 	product
		where 	product_type = 0
	</select>
	
	<select id="wonProductList" parameterType="ProductDto" resultType="ProductDto">
		select *
		from (
		    select rownum rn, a.*
		    from (
		        select 
		            p.*, 
		            bu.cd_contents as unitName,
		            bt.cd_contents as typeName,
		            bi.cd_contents as isorderName
		        from product p
		        left join bunryu bu 
		        	ON p.product_unit = bu.mcd and bu.bcd = 750
		        left join bunryu bt 
		        	ON p.product_type = bt.mcd and bt.bcd = 700
		        left join bunryu bi 
		        	ON p.product_isorder = bi.mcd and bi.bcd = 800
		        where p.product_type = #{product_type}
		        order by p.product_code desc
		    ) a
		)
		where rn between #{start} and #{end}
	</select>
	
	<select id="wonProductDetail" parameterType="int" resultType="ProductDto">
		select  p.*, 
	            bu.cd_contents as unitName,
	            bt.cd_contents as typeName,
	            bi.cd_contents as isorderName,
	            e.emp_name	   as regName
	   	from 	product p
	    left join bunryu bu 
	    	ON p.product_unit = bu.mcd 		and bu.bcd = 750
	    left join bunryu bt 
	    	ON p.product_type = bt.mcd 		and bt.bcd = 700
	    left join bunryu bi 
	    	ON p.product_isorder = bi.mcd 	and bi.bcd = 800
    	left join emp e
    		ON p.product_reg_code = e.emp_code
	    where product_code = #{product_code}
	</select>
	
	<update id="wonProductModify" parameterType="ProductDto">
	    update product
	    set product_name     = #{product_name},
	        product_unit     = #{product_unit},
	        product_type     = #{product_type},
	        product_weight   = #{product_weight},
	        product_isorder  = #{product_isorder},
	        product_isdel    = #{product_isdel}
	    where product_code   = #{product_code}
	</update>
	
	<update id="wonProductDelete" parameterType="ProductDto">
	    update product
	    set product_isdel    = #{product_isdel}
	    where product_code   = #{product_code}
	</update>

	<select id="productInfo" parameterType="int" resultType="ProductDto" >
		select product_code, product_name
		from product
		where product_type = #{product_type}
	</select>
	
	
</mapper>